<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">

  <title>Relatório de Consumo</title>

  <link rel="stylesheet" href="../static/styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"> -->


  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>



<body class="bg-custom">

  <div class="container py-5">

    <ul class="nav nav-pills nav-fill gap-2 p-1 small bg-dark rounded-5 shadow-sm" id="pillNav2" role="tablist" style="--bs-nav-link-color: var(--bs-white); --bs-nav-pills-link-active-color: var(--bs-primary); --bs-nav-pills-link-active-bg: var(--bs-white);">
      <li class="nav-item" role="presentation">
          <a class="nav-link active rounded-5" id="home-tab2" href="{{ url_for('index') }}" type="button" role="tab" aria-selected="true">Consumo em tempo real</a>
       </li>
      <li class="nav-item" role="presentation">
          <a class="nav-link rounded-5" id="profile-tab2" href="{{ url_for('report') }}" type="button" role="tab" aria-selected="false">Relatório de consumo</a>
      </li>
      <li class="nav-item" role="presentation">
          <a class="nav-link rounded-5" id="contact-tab2" href="{{ url_for('dashboard') }}" type="button" role="tab" aria-selected="false">Dashboard</a>
      </li>
    </ul>
    <br/>


    <h2 class="mb-4">Relatório de Consumo</h2>


    <!-- Formulário de datas -->
    <form id="reportForm" class="row g-3 mb-4">
      <div class="col-md-5">
        <label for="start" class="form-label">Data início</label>
        <input type="datetime-local" class="form-control" id="start" required>
      </div>
      <div class="col-md-5">
        <label for="end" class="form-label">Data fim</label>
        <input type="datetime-local" class="form-control" id="end" required>
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">Gerar</button>
      </div>
    </form>

    <!-- Gráfico -->
    <canvas id="reportChart" height="100"></canvas>
  </div>

  <script>
    const ctx = document.getElementById('reportChart').getContext('2d');
    const reportChart = new Chart(ctx, {
      type: 'line',
      data: { labels: [], datasets: [
        { label: 'Download (Mbps)', data: [], borderColor: 'blue', fill: false },
        { label: 'Upload (Mbps)', data: [], borderColor: 'red', fill: false }
      ]},
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    document.getElementById("reportForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const start = document.getElementById("start").value.replace("T"," ");
      const end = document.getElementById("end").value.replace("T"," ");

      fetch(`/report_data?start=${start}&end=${end}`)
        .then(res => res.json())
        .then(data => {
          const labels = data.map(row => row.time);
          const download = data.map(row => row.rx);
          const upload = data.map(row => row.tx);

          reportChart.data.labels = labels;
          reportChart.data.datasets[0].data = download;
          reportChart.data.datasets[1].data = upload;
          reportChart.update();
        });
    });
  </script>
</body>
</html>


