<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">

  <title>Relat√≥rio de Consumo</title>

  <link rel="stylesheet" href="../static/styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"> -->


  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>



<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Dashboard de Estat√≠sticas</title>
  <link rel="stylesheet" href="../static/styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-custom">

  <div class="container py-5">

    <!-- Menu de navega√ß√£o -->
    <ul class="nav nav-pills nav-fill gap-2 p-1 small bg-dark rounded-5 shadow-sm" id="pillNav2" role="tablist" style="--bs-nav-link-color: var(--bs-white); --bs-nav-pills-link-active-color: var(--bs-primary); --bs-nav-pills-link-active-bg: var(--bs-white);">
      <li class="nav-item" role="presentation">
          <a class="nav-link active rounded-5" id="home-tab2" href="{{ url_for('index') }}" type="button" role="tab" aria-selected="true">Consumo em tempo real</a>
       </li>
      <li class="nav-item" role="presentation">
          <a class="nav-link rounded-5" id="profile-tab2" href="{{ url_for('report') }}" type="button" role="tab" aria-selected="false">Relat√≥rio de consumo</a>
      </li>
      <li class="nav-item" role="presentation">
          <a class="nav-link rounded-5" id="contact-tab2" href="{{ url_for('dashboard') }}" type="button" role="tab" aria-selected="false">Dashboard</a>
      </li>
    </ul>
    <br/>

    <br>
    <h2 class="mb-4">üìä Dashboard de Estat√≠sticas</h2>

    <!-- Filtro de datas -->
    <form id="dashboardForm" class="row g-3 mb-4">
      <div class="col-md-5">
        <label for="start" class="form-label">Data in√≠cio</label>
        <input type="datetime-local" class="form-control" id="start">
      </div>
      <div class="col-md-5">
        <label for="end" class="form-label">Data fim</label>
        <input type="datetime-local" class="form-control" id="end">
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">Filtrar</button>
      </div>
    </form>

    <!-- Cards -->
    <div class="row text-center mb-4">
      <div class="col-md-3">
        <div class="card bg-light shadow-sm p-3">
          <h5>M√©dia Upload</h5>
          <p class="fs-4 text-primary" id="avgDownload">--</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-light shadow-sm p-3">
          <h5>M√©dia Download</h5>
          <p class="fs-4 text-success" id="avgUpload">--</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-light shadow-sm p-3">
          <h5>Total Upload</h5>
          <p class="fs-4 text-danger" id="maxDownload">--</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-light shadow-sm p-3">
          <h5>Total Download</h5>
          <p class="fs-4 text-warning" id="maxUpload">--</p>
        </div>
      </div>
    </div>

    <!-- Gr√°fico -->
    <canvas id="statsChart" height="100"></canvas>

  </div>

  <script>
    const ctx = document.getElementById('statsChart').getContext('2d');
    const statsChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Download', 'Upload'],
        datasets: [
          { label: 'M√©dia (Mbps)', data: [0, 0], backgroundColor: 'rgba(54, 162, 235, 0.6)' },
          { label: 'Pico (Mbps)', data: [0, 0], backgroundColor: 'rgba(255, 99, 132, 0.6)' }
        ]
      },
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    function loadDashboard(start=null, end=null) {
      let url = "/dashboard_data";
      if (start && end) {
        url += `?start=${start}&end=${end}`;
      }

      fetch(url)
        .then(res => res.json())
        .then(stats => {
          document.getElementById("avgDownload").textContent = stats.avg_download.toFixed(2) + " Mbps";
          document.getElementById("avgUpload").textContent = stats.avg_upload.toFixed(2) + " Mbps";
          document.getElementById("maxDownload").textContent = stats.max_download.toFixed(2) + " Mbps";
          document.getElementById("maxUpload").textContent = stats.max_upload.toFixed(2) + " Mbps";

          statsChart.data.datasets[0].data = [stats.avg_download, stats.avg_upload];
          statsChart.data.datasets[1].data = [stats.max_download, stats.max_upload];
          statsChart.update();
        });
    }

    // Primeiro carregamento
    loadDashboard();

    // Filtro por datas
    document.getElementById("dashboardForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const start = document.getElementById("start").value.replace("T"," ");
      const end = document.getElementById("end").value.replace("T"," ");
      loadDashboard(start, end);
    });

  </script>




  


</body>
</html>


